# 一船一成本 - 移动端开发设计文档

## 一、项目概述

**应用名称**：一船一成本（工业智脑子模块）
**应用类型**：船舶建造成本管理移动端
**技术栈**：uni-app + Vue 3 + Pinia
**目标平台**：H5 / 微信小程序 / App

---

## 二、页面结构与功能分析

根据原型截图，共识别出以下页面/模块：

### 2.1 入口页（图1）

**路径**：`pages/index/index`

| 功能点 | 说明 |
|--------|------|
| 顶部 Banner | "工业智脑" 蓝色背景 + 船舶装饰图 |
| 功能入口卡片 | "一船一成本" 带船舶背景图片，点击箭头进入总览页 |
| 导航栏 | 左侧返回 `<`，标题 "一船一成本"，右侧关闭 `×` |

---

### 2.2 总览页（图2 + 图4）

**路径**：`pages/overview/index`
**TabBar 页**：总览（首个 Tab）

| 功能点 | 说明 |
|--------|------|
| 顶部筛选区 | 左上角四宫格菜单图标；部门下拉选择（工业总部）；月份下拉选择（2025-12） |
| 成本概况卡片 | 6 个核心指标，2×3 网格布局 |
| - 合同收入 | 金额（万元），可点击跳转，同比/环比 |
| - 预算成本 | 金额（万元），同比/环比 |
| - 业务成本 | 金额（万元），同比/环比 |
| - 预计总成本 | 金额（万元），同比/环比 |
| - 业务边际贡献 | 金额（万元），同比/环比 |
| - 业务边际贡献率 | 百分比，同比/环比 |
| 数据截止时间 | 右上角显示截止日期 |
| 预计总成本变化趋势 | **柱状图**，X 轴为月份，图例：预算成本（蓝）、业务成本（绿） |
| 基地成本控制情况 | **柱状图**，X 轴为各基地名称，图例：预算成本（蓝）、预计总成本（橙） |
| 重点关注项目 | 横向滑动卡片列表，显示船名、基地、船型、预计超支额，超支风险标记徽章 |

---

### 2.3 成本分布页（图5 + 图6）

**路径**：`pages/overview/cost-distribution`（总览页向下滚动 或 独立子页）

| 功能点 | 说明 |
|--------|------|
| 成本分布 - 环形图 | **环形图（Doughnut）**，中心显示总金额，展示五大成本类别占比 |
| 成本类别 | 设备、材料、人工、专项、大包，各附同比/环比 |
| 总成本切换 | 右上角下拉可切换"总成本"/"业务成本"等维度 |
| 成本下钻（旭日图/饼图） | 点击某类别后展开子项（如 设备→电气设备→电力系统/照明系统/导航系统等），显示各子项金额和占比 |
| 基地排名 | Tab 切换：超支率、合同收入、预算成本、预计总成本 |
| 排名列表 | 序号奖牌图标 + 基地名称 + 对应指标值 |

---

### 2.4 船舶列表页

**路径**：`pages/ship/index`
**TabBar 页**：船舶（第二个 Tab）

| 功能点 | 说明 |
|--------|------|
| 船舶列表 | 展示所有船舶项目卡片（从重点关注项目推断） |
| 搜索/筛选 | 按基地、船型、状态筛选 |
| 卡片信息 | 船名、基地、船型、超支额/预算等关键指标 |

---

### 2.5 项目详情页（图3）

**路径**：`pages/ship/detail`

| 功能点 | 说明 |
|--------|------|
| 顶部标题栏 | 返回按钮 + "项目详情" |
| 项目选择器 | 下拉切换船舶项目（如 AJ9000PCTC-4） |
| 项目 PK 按钮 | 右上角 "项目PK" 按钮，跳转项目对比页 |
| 项目信息卡片 | 船舶图片、船名、船号、船型、收藏（星标） |
| 基本属性 | 基地、项目经理、状态（已交船等）、客户、交付日期 |
| 成本概况 | 3×2 网格：合同收入、预算成本、业务成本、预计总成本、业务边际贡献、业务边际贡献率，含环比 |
| 成本分布 | 环形图 + 下钻（复用成本分布组件） |

---

### 2.6 项目对比页（图7 + 图8）

**路径**：`pages/ship/compare`

| 功能点 | 说明 |
|--------|------|
| 顶部对比卡片 | 左右两船信息（船名、基地、船型、图片），中间 PK 图标 |
| 雷达图 | **五维雷达图**对比：设备、材料、人工、专项、大包 |
| 分项条形对比 | 左右对称条形图，逐项比较金额（设备、材料、人工、专项） |
| 工程分类 Tab | 船体工程、大型舾装安装工程、铁舾装工程、电气工程 |
| 工程子项对比 | 每个 Tab 下展示对应工程子项的左右对比条形图 |

---

### 2.7 我的页

**路径**：`pages/mine/index`
**TabBar 页**：我的（第三个 Tab）

| 功能点 | 说明 |
|--------|------|
| 用户信息 | 头像、姓名、部门 |
| 常用设置 | 默认部门、收藏项目管理等 |

---

## 三、TabBar 配置

```
TabBar（3个入口）：
├── 总览（首页图标）  → pages/overview/index
├── 船舶（船舶图标）  → pages/ship/index
└── 我的（人物图标）  → pages/mine/index
```

---

## 四、组件设计

### 4.1 推荐使用的 uni-app 组件 / 第三方库

| 组件需求 | 推荐方案 | 说明 |
|----------|----------|------|
| 图表（柱状图/环形图/雷达图） | **uCharts**（uni_modules） 或 **echarts-for-uniapp** | uCharts 原生 Canvas 渲染，跨端兼容性好；echarts 功能更强但体积较大 |
| 下拉选择器 | `uni-data-select` / `uni-popup` + 自定义 picker | 部门选择、月份选择 |
| 数字动画 | `uni-number-box` / 自定义数字滚动组件 | 金额大数字展示 |
| 标签页切换 | `uni-segmented-control` / `uni-tab-bar` | 基地排名 Tab、工程分类 Tab |
| 卡片容器 | 自定义 `cost-card` 组件 | 成本概况、项目信息等统一卡片样式 |
| 横向滚动列表 | `scroll-view` (direction=horizontal) | 重点关注项目卡片 |
| 徽章/标记 | `uni-badge` | 超支风险标记 |
| 图标 | `uni-icons` + 自定义 iconfont | 导航图标、功能图标 |
| 下拉刷新 | 页面级 `onPullDownRefresh` | 数据刷新 |
| 骨架屏 | 自定义 skeleton 组件 | 数据加载中占位 |

### 4.2 自定义业务组件

```
components/
├── CostSummaryCard/       # 成本概况卡片（6 指标网格）
│   └── index.vue
├── CostIndicator/         # 单个成本指标项（金额 + 同比/环比）
│   └── index.vue
├── CostDistribution/      # 成本分布环形图 + 图例
│   └── index.vue
├── CostDrillDown/         # 成本下钻饼图（旭日图样式）
│   └── index.vue
├── TrendChart/            # 趋势柱状图（预算vs业务成本）
│   └── index.vue
├── BaseCompareChart/      # 基地成本对比柱状图
│   └── index.vue
├── RadarCompare/          # 项目对比雷达图
│   └── index.vue
├── BarCompare/            # 左右对称条形对比图
│   └── index.vue
├── ProjectCard/           # 项目信息卡片（图片+基本信息）
│   └── index.vue
├── ProjectFocusList/      # 重点关注项目横滑列表
│   └── index.vue
├── RankList/              # 基地排名列表
│   └── index.vue
├── FilterBar/             # 筛选栏（部门+月份）
│   └── index.vue
└── SectionTitle/          # 带竖线的区块标题
    └── index.vue
```

---

## 五、数据结构设计（前端模型）

### 5.1 成本概况

```js
{
  contractIncome: 256716.00,    // 合同收入（万元）
  budgetCost: 184984.73,        // 预算成本
  businessCost: 170596.13,      // 业务成本
  estimatedTotalCost: 174310.17,// 预计总成本
  marginalContribution: 83047.15,// 业务边际贡献
  marginalRate: 32.35,          // 业务边际贡献率（%）
  dataDate: '2025-12-04',       // 数据截止日期
  // 每个指标附带：
  yoy: null,                    // 同比（可为 null）
  mom: 0.00,                    // 环比
  momTrend: 'up'                // 环比趋势 up/down
}
```

### 5.2 项目信息

```js
{
  projectCode: 'AJ9000PCTC-4',
  shipName: 'AJ9000PCTC-4',
  shipNo: 'JLZ8230408',
  shipType: '车滚船',
  base: '南京金陵',
  manager: '-',
  status: '已交船',
  customer: '安吉物流（香港）控股有限...',
  deliveryDate: '2025-10-22',
  image: '/static/ship-default.png',
  isFavorite: true
}
```

### 5.3 成本分布

```js
{
  totalAmount: 170596.13,
  type: '业务成本',               // 可切换：总成本/业务成本
  items: [
    { name: '设备', amount: 64262.38, ratio: 37.64, yoy: null, mom: 0.00 },
    { name: '材料', amount: 60614.80, ratio: 35.53, yoy: null, mom: 0.00 },
    { name: '人工', amount: 34142.38, ratio: 20.01, yoy: null, mom: 0.00 },
    { name: '专项', amount: 10937.21, ratio: 6.41, yoy: null, mom: 0.00 },
    { name: '大包', amount: 699.44, ratio: 0.41, yoy: null, mom: 0.00 }
  ],
  // 下钻子项
  children: {
    '设备/电气设备': [
      { name: '电力系统', amount: 3122.25, ratio: 44.24 },
      { name: '照明系统', amount: 1144.55, ratio: 16.22 },
      { name: '导航系统', amount: 980.17, ratio: 13.89 },
      // ...
    ]
  }
}
```

### 5.4 项目对比

```js
{
  projectA: { code: 'AJ9000PCTC-4', base: '南京金陵', shipType: '车滚船' },
  projectB: { code: 'AJ9000PCTC-1', base: '南京金陵', shipType: '车滚船' },
  radarData: {
    dimensions: ['设备', '材料', '人工', '专项', '大包'],
    projectA: [18584.27, 16637.53, 9238.37, 2987.55, 215.15],
    projectB: [17030.33, 16839.55, 9200.31, 2133.89, 183.16]
  },
  engineeringCompare: {
    tabs: ['船体工程', '大型舾装安装工程', '铁舾装工程', '电气工程'],
    '船体工程': [
      { name: '船体工程', a: 4661.06, b: 4163.05 },
      { name: '预处理', a: 25.00, b: 25.00 },
      { name: '碳钢船体', a: 4636.06, b: 4138.05 },
      { name: '不锈钢船体', a: 0.00, b: 0.00 }
    ]
  }
}
```

---

## 六、页面路由配置（pages.json）

```json
{
  "tabBar": {
    "color": "#999999",
    "selectedColor": "#2979FF",
    "list": [
      { "pagePath": "pages/overview/index", "text": "总览", "iconPath": "static/tab/home.png", "selectedIconPath": "static/tab/home-active.png" },
      { "pagePath": "pages/ship/index", "text": "船舶", "iconPath": "static/tab/ship.png", "selectedIconPath": "static/tab/ship-active.png" },
      { "pagePath": "pages/mine/index", "text": "我的", "iconPath": "static/tab/mine.png", "selectedIconPath": "static/tab/mine-active.png" }
    ]
  },
  "pages": [
    { "path": "pages/overview/index", "style": { "navigationBarTitleText": "一船一成本" } },
    { "path": "pages/ship/index", "style": { "navigationBarTitleText": "船舶" } },
    { "path": "pages/ship/detail", "style": { "navigationBarTitleText": "一船一成本" } },
    { "path": "pages/ship/compare", "style": { "navigationBarTitleText": "一船一成本" } },
    { "path": "pages/mine/index", "style": { "navigationBarTitleText": "我的" } }
  ]
}
```

---

## 七、配色方案

| 用途 | 色值 |
|------|------|
| 主色（蓝） | `#2979FF` |
| 顶部渐变背景 | `#2979FF` → `#4B9AFF` |
| 成功/正向 | `#00C48C`（绿） |
| 警告/超支 | `#FF6B6B`（红） |
| 辅助色（橙） | `#FFA940` |
| 文字主色 | `#333333` |
| 文字次色 | `#666666` |
| 文字辅助色 | `#999999` |
| 背景色 | `#F5F6FA` |
| 卡片背景 | `#FFFFFF` |
| 分割线 | `#EEEEEE` |
| 环比上涨 | `#FF4D4F`（红色▲） |
| 环比下降 | `#00C48C`（绿色▼） |
| 区块标题竖线 | `#2979FF` |

---

## 八、开发优先级

| 阶段 | 内容 | 页面/组件 |
|------|------|-----------|
| P0 | 基础框架搭建 | TabBar、路由、全局样式、筛选栏 |
| P0 | 总览页 | 成本概况卡片、趋势柱状图 |
| P1 | 成本分布 | 环形图、下钻饼图、基地排名 |
| P1 | 项目详情 | 项目信息卡片、详情页成本概况 |
| P1 | 基地成本控制 | 基地柱状图、重点关注项目列表 |
| P2 | 项目对比 | 雷达图、对称条形对比、工程分类 Tab |
| P2 | 船舶列表 | 搜索筛选、列表展示 |
| P3 | 我的页面 | 用户信息、设置 |

---

## 九、关键技术要点

1. **图表选型**：推荐 `uCharts`（@qiun/ucharts），原生 Canvas 渲染，跨端兼容（H5/小程序/App），支持柱状图、环形图、雷达图、条形图等所有需要的图表类型
2. **大数字格式化**：统一使用千分位格式 + 两位小数，封装 `formatMoney()` 工具函数
3. **同比环比展示**：封装 `RatioTag` 组件，自动根据正负值显示红色▲/绿色▼
4. **下拉筛选联动**：部门、月份切换时需整页数据刷新，使用 Pinia 管理全局筛选状态
5. **成本下钻**：支持多级点击下钻（如 总成本→设备→电气设备→电力系统），用栈结构管理层级路径
6. **项目对比选择**：从详情页 "项目PK" 入口进入，需实现项目搜索选择弹窗
7. **响应式设计**：采用断点适配策略，确保 PC、Pad、手机三端布局合理，详见第十章

---

## 十、响应式设计方案

### 10.1 设计原则

- **移动优先（Mobile First）**：默认样式以手机端为基准，通过媒体查询逐步增强 Pad 和 PC 端布局
- **内容一致性**：三端展示相同的数据和功能，仅布局结构和信息密度有差异
- **uni-app 跨端兼容**：利用 uni-app 的 `rpx` 单位 + CSS 媒体查询 + 条件编译实现多端适配

### 10.2 断点定义

| 断点名称 | 屏幕宽度 | 目标设备 | 布局策略 |
|----------|----------|----------|----------|
| `sm` (手机) | < 768px | 手机竖屏 | 单列布局，卡片堆叠 |
| `md` (平板) | 768px ~ 1199px | iPad / Android Pad | 双列布局，左右分栏 |
| `lg` (桌面) | >= 1200px | PC 浏览器 | 三列/多列布局，充分利用横向空间 |

```css
/* 基础样式（手机端） */
.container { padding: 24rpx; }

/* Pad 端 */
@media screen and (min-width: 768px) {
  .container { padding: 32rpx 48rpx; max-width: 1024px; margin: 0 auto; }
}

/* PC 端 */
@media screen and (min-width: 1200px) {
  .container { padding: 40rpx 60rpx; max-width: 1440px; margin: 0 auto; }
}
```

### 10.3 各页面响应式布局规则

#### 总览页

| 模块 | 手机 (< 768px) | Pad (768px~1199px) | PC (>= 1200px) |
|------|----------------|---------------------|-----------------|
| 成本概况卡片 | 2×3 网格 | 3×2 网格 | 6×1 单行排列 |
| 趋势柱状图 | 全宽显示 | 全宽显示 | 左半区（50%） |
| 基地成本柱状图 | 全宽显示 | 全宽显示 | 右半区（50%） |
| 成本分布环形图 | 全宽，图例在下方 | 图表左 + 图例右 | 图表左 + 图例右 |
| 基地排名列表 | 全宽列表 | 全宽列表 | 右侧边栏卡片 |
| 重点关注项目 | 横向滑动 | 横向滑动（显示3张） | 横向排列（显示4~5张） |

#### 项目详情页

| 模块 | 手机 | Pad | PC |
|------|------|-----|-----|
| 项目信息卡片 | 纵向排列 | 左图右信息 | 左图右信息，宽卡片 |
| 成本概况 | 2×3 网格 | 3×2 网格 | 6×1 单行 |
| 成本分布 | 全宽堆叠 | 左环形图 右详情 | 左环形图 右详情 |

#### 项目对比页

| 模块 | 手机 | Pad | PC |
|------|------|-----|-----|
| 顶部对比卡片 | 左右紧凑排列 | 左右宽松排列 | 左右宽松 + 详细信息 |
| 雷达图 | 全宽 | 左侧60% | 左侧50% |
| 分项条形对比 | 全宽 | 右侧40% | 右侧50% |
| 工程分类 Tab | 横向滚动 Tab | 全部展示 | 全部展示 |

#### 船舶列表页

| 模块 | 手机 | Pad | PC |
|------|------|-----|-----|
| 搜索筛选栏 | 堆叠排列 | 单行排列 | 单行排列 |
| 船舶卡片列表 | 单列 | 双列网格 | 三列网格 |

### 10.4 关键适配策略

#### (1) 弹性网格布局

使用 CSS Grid / Flexbox 实现自适应网格，避免固定列数：

```css
/* 成本概况卡片网格 */
.cost-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 手机：2列 */
  gap: 20rpx;
}

@media screen and (min-width: 768px) {
  .cost-grid {
    grid-template-columns: repeat(3, 1fr); /* Pad：3列 */
  }
}

@media screen and (min-width: 1200px) {
  .cost-grid {
    grid-template-columns: repeat(6, 1fr); /* PC：6列 */
  }
}
```

#### (2) 图表自适应

- 图表组件接收 `width` / `height` 属性，通过父容器宽度动态计算
- 使用 `uni.getSystemInfoSync()` 获取屏幕宽度，动态传入图表尺寸
- PC 端图表可显示更多数据标签和辅助线，手机端精简显示

```js
// 图表尺寸自适应
const sysInfo = uni.getSystemInfoSync()
const screenWidth = sysInfo.windowWidth
const chartWidth = screenWidth < 768 ? screenWidth - 48 :
                   screenWidth < 1200 ? screenWidth * 0.5 - 60 :
                   600
```

#### (3) 字体与间距缩放

| 元素 | 手机 | Pad | PC |
|------|------|-----|-----|
| 页面标题 | 36rpx | 40rpx | 44rpx |
| 卡片标题 | 28rpx | 30rpx | 32rpx |
| 正文/数值 | 24rpx | 26rpx | 28rpx |
| 辅助文字 | 22rpx | 24rpx | 24rpx |
| 卡片内间距 | 24rpx | 32rpx | 40rpx |
| 卡片外间距 | 20rpx | 24rpx | 32rpx |

#### (4) PC 端 H5 宽屏适配

利用 uni-app 的 `leftWindow` / `topWindow` 配置，为 H5 PC 端提供侧边导航和顶部导航：

```json
// pages.json 中添加（仅 H5 端生效）
{
  "topWindow": {
    "path": "windows/top-window",
    "style": { "height": "60px" }
  },
  "leftWindow": {
    "path": "windows/left-window",
    "style": { "width": "240px" }
  }
}
```

- **topWindow**：PC 端顶部显示应用名称 + 全局筛选（部门/月份）
- **leftWindow**：PC 端左侧显示 TabBar 对应的导航菜单（总览/船舶/我的），替代底部 TabBar

#### (5) 触控与交互适配

| 交互方式 | 手机/Pad | PC |
|----------|----------|-----|
| 下拉刷新 | 手势下拉触发 | 刷新按钮 / 下拉手势 |
| 横向滑动卡片 | 手指左右滑动 | 鼠标拖拽 + 左右箭头按钮 |
| 下钻图表 | 点击区域 | 点击 + hover 高亮提示 |
| 筛选操作 | 底部弹出 picker | 下拉菜单（inline） |

### 10.5 响应式工具类

封装全局 CSS 工具类，便于快速实现响应式隐藏/显示：

```css
/* 响应式显示/隐藏 */
.hidden-sm { display: block; }
.visible-sm { display: none; }

@media screen and (max-width: 767px) {
  .hidden-sm { display: none !important; }
  .visible-sm { display: block !important; }
}

@media screen and (min-width: 768px) and (max-width: 1199px) {
  .hidden-md { display: none !important; }
  .visible-md { display: block !important; }
}

@media screen and (min-width: 1200px) {
  .hidden-lg { display: none !important; }
  .visible-lg { display: block !important; }
}
```
